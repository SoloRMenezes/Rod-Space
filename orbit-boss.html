<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Orbit Boss — Auto Orbit Version</title>
<style>
  html,body{height:100%;margin:0;background:#0b1020;color:#e9eef9;font-family:system-ui,Segoe UI,Roboto,Helvetica,Arial,sans-serif;overflow:hidden}
  #hud{position:fixed;inset:0 0 auto 0;display:flex;gap:.6rem;align-items:center;justify-content:center;padding:.45rem;pointer-events:none}
  #hud .pill{background:#111a35;border:1px solid #263158;padding:.3rem .55rem;border-radius:999px;box-shadow:0 1px 8px rgba(0,0,0,.35)}
  #hud .pill strong{color:#9bd1ff}
  canvas{display:block;width:100vw;height:100vh}
  #centerMsg{position:fixed;inset:0;display:grid;place-items:center;font-weight:700;letter-spacing:.5px;text-align:center;transition:opacity .35s ease}
  #centerMsg.hidden{opacity:0;pointer-events:none}
  #centerMsg .card{background:rgba(7,10,24,.85);border:1px solid #24305a;border-radius:16px;padding:18px 20px;max-width:680px}
  kbd{background:#101735;border:1px solid #31407a;border-bottom-width:2px;border-radius:6px;padding:.1rem .3rem;color:#cfe5ff}
</style>
</head>
<body>
<canvas id="game"></canvas>
<div id="hud"></div>
<div id="centerMsg"><div class="card" id="msg">Orbit Boss<br><small>Auto-fire. Move with <kbd>WASD</kbd>. <kbd>R</kbd> to restart.</small></div></div>
<script>
(() => {
  const canvas = document.getElementById('game');
  const ctx = canvas.getContext('2d');
  const hud = document.getElementById('hud');
  const centerMsg = document.getElementById('centerMsg');
  const msg = document.getElementById('msg');

  const state = { w: innerWidth, h: innerHeight, running: true, level: 1, score: 0, time: 0, rngSeed: 1337, moved:false };
  function resize(){ canvas.width = state.w = innerWidth * devicePixelRatio; canvas.height = state.h = innerHeight * devicePixelRatio; ctx.setTransform(devicePixelRatio,0,0,devicePixelRatio,0,0);} addEventListener('resize', resize, {passive:true}); resize();

  const TAU = Math.PI*2; const clamp=(v,a,b)=>Math.max(a,Math.min(b,v)); function rand(){ state.rngSeed=(1103515245*state.rngSeed+12345)&0x7fffffff; return state.rngSeed/0x7fffffff; }

  const player = { angle: 0, radius: 170, minR: 110, maxR: 250, speed: 2.4, dir: 1, alive:true, fireTimer:0, firePeriod:2.0 };
  const boss = { hp: 20, maxHp: 20, coreR: 24, eyePhase:0, armsPhase:0, rings:[], ringSpeedBase:0.8, fireTimer:0, fireCooldown:1.4 };
  const keys = new Set();
  const bullets = [];

  onkeydown = (e)=>{ const k=e.key.toLowerCase(); if(['w','a','s','d','r'].includes(k)) e.preventDefault(); keys.add(k); if(!state.moved && ['w','a','s','d'].includes(k)) hideCenter(); if(k==='a'||k==='d'){ player.dir*=-1; } };
  onkeyup = (e)=>{ keys.delete(e.key.toLowerCase()); };

  function initLevel(){
    const lvl = state.level;
    boss.maxHp = Math.floor(18 + (lvl-1)*9);
    boss.hp = boss.maxHp;
    boss.fireCooldown = Math.max(0.9, 1.6 - (lvl-1)*0.08);
    player.firePeriod = clamp(2.0 - (lvl-1)*0.2, 0.3, 2.0);

    boss.rings = [];
    const ringCount = clamp(lvl-1, 0, 3);
    const baseR = 90; const ringSpacing = 30;
    for(let i=0;i<ringCount;i++){
      const r = baseR + i*ringSpacing;
      const w = 10; const gap = clamp(0.85 - i*0.1, 0.5, 1.1); const speed = boss.ringSpeedBase * (1 + i*0.3) * (i%2?-1:1) * (rand()*0.4+0.8);
      boss.rings.push({ r, w, gap, angle: rand()*TAU, speed });
    }
  }

  function reset(){ state.level=1; state.score=0; state.time=0; state.running=true; state.rngSeed=1337; player.angle=0; player.radius=170; player.alive=true; player.fireTimer=0; player.dir=1; bullets.length=0; state.moved=false; centerMsg.classList.remove('hidden'); initLevel(); }
  function nextLevel(){ state.level++; state.score+=150; bullets.length=0; initLevel(); flash(`Level ${state.level}<br><small>New ring & tougher pattern.</small>`); }

  function flash(html){ msg.innerHTML=html; centerMsg.classList.remove('hidden'); setTimeout(()=>centerMsg.classList.add('hidden'),2500); }
  function showGameOver(){ centerMsg.classList.remove('hidden'); msg.innerHTML=`<div style='font-size:1.2rem;margin-bottom:.3rem;'>Game Over</div><div>Score: <strong>${state.score}</strong> — Level: <strong>${state.level}</strong></div><div>Press <kbd>R</kbd> to restart</div>`; }
  function hideCenter(){ centerMsg.classList.add('hidden'); state.moved=true; }

  function shootPlayer(){ const cx=state.w/2, cy=state.h/2; const px=cx+Math.cos(player.angle)*player.radius; const py=cy+Math.sin(player.angle)*player.radius; const ang=Math.atan2(cy-py,cx-px); const spd=560; bullets.push({x:px,y:py,vx:Math.cos(ang)*spd,vy:Math.sin(ang)*spd,r:3,owner:'p',type:'normal',age:0,ttl:4}); }

  function update(dt){
    state.time += dt; if(!player.alive) return;
    player.angle += player.dir * player.speed * dt;
    if(keys.has('w')) player.radius -= 130*dt;
    if(keys.has('s')) player.radius += 130*dt;
    player.radius = clamp(player.radius, player.minR, player.maxR);

    player.fireTimer += dt; if(player.fireTimer >= player.firePeriod){ player.fireTimer=0; shootPlayer(); }

    boss.fireTimer += dt; if(boss.fireTimer >= boss.fireCooldown){ boss.fireTimer=0; bossVolley(); }
    for(const r of boss.rings) r.angle += r.speed*dt;

    for(let i=bullets.length-1;i>=0;i--){ const b=bullets[i]; b.x+=b.vx*dt; b.y+=b.vy*dt; b.age=(b.age||0)+dt; if(b.x<-80||b.y<-80||b.x>state.w+80||b.y>state.h+80){ bullets.splice(i,1); continue; } const cx=state.w/2, cy=state.h/2; const dx=b.x-cx, dy=b.y-cy; const dist=Math.hypot(dx,dy); if(b.owner==='p'){ let blocked=false; for(const ring of boss.rings){ const inBand=dist>(ring.r-ring.w/2)&&dist<(ring.r+ring.w/2); if(inBand){ let a=Math.atan2(dy,dx)-ring.angle; a%=TAU; if(a<0)a+=TAU; if(a>ring.gap){blocked=true;break;} } } if(blocked){ bullets.splice(i,1); continue; } if(dist<=boss.coreR){ bullets.splice(i,1); boss.hp--; state.score+=5; if(boss.hp<=0) nextLevel(); } } else { const px=state.w/2+Math.cos(player.angle)*player.radius, py=state.h/2+Math.sin(player.angle)*player.radius; if(Math.hypot(b.x-px,b.y-py)<9.5){ bullets.splice(i,1); player.alive=false; showGameOver(); state.running=false; } } }
  }

  function bossVolley(){ const lvl=state.level; let count=1; if(lvl>=2)count=2; if(lvl>=3)count=4; if(lvl>=4)count=8; count=Math.min(count,8); const cx=state.w/2,cy=state.h/2; const px=cx+Math.cos(player.angle)*player.radius, py=cy+Math.sin(player.angle)*player.radius; const aimAng=Math.atan2(py-cy,px-cx); const dirs=[]; for(let i=0;i<count;i++)dirs.push(rand()*TAU); let best=0,bestDiff=999; for(let i=0;i<dirs.length;i++){let d=Math.abs(((dirs[i]-aimAng+Math.PI)%TAU)-Math.PI); if(d<bestDiff){bestDiff=d;best=i;}} dirs[best]=aimAng; for(const a of dirs){ const spd=180+lvl*25; bullets.push({x:cx,y:cy,vx:Math.cos(a)*spd,vy:Math.sin(a)*spd,r:3.2,owner:'b',age:0}); } }

  function drawShip(x,y,ang){ ctx.save(); ctx.translate(x,y); ctx.rotate(ang); ctx.fillStyle='#e8f4ff'; ctx.beginPath(); ctx.moveTo(13,0); ctx.lineTo(-11,-7); ctx.lineTo(-5,0); ctx.lineTo(-11,7); ctx.closePath(); ctx.fill(); ctx.fillStyle='#9bd1ff'; ctx.beginPath(); ctx.arc(0,0,3,0,TAU); ctx.fill(); const pulse=2.6+Math.sin(state.time*10)*1.1; ctx.fillStyle='#fff7c2'; ctx.beginPath(); ctx.moveTo(-11,0); ctx.lineTo(-17,-pulse); ctx.lineTo(-17,pulse); ctx.closePath(); ctx.fill(); ctx.restore(); }

  function drawBoss(cx,cy){ const t=state.time; const r=boss.coreR+Math.sin(t*2)*1.2; const grd=ctx.createRadialGradient(cx,cy,2,cx,cy,r+7); grd.addColorStop(0,'#ffd3e6'); grd.addColorStop(1,'#5a1833'); ctx.fillStyle=grd; ctx.beginPath(); ctx.arc(cx,cy,r,0,TAU); ctx.fill(); ctx.fillStyle='#ff7bb0'; ctx.beginPath(); ctx.arc(cx,cy,6,0,TAU); ctx.fill(); ctx.fillStyle='#2a0613'; ctx.beginPath(); ctx.arc(cx+Math.sin(t*1.3)*1.2, cy, 2.5, 0, TAU); ctx.fill(); ctx.save(); ctx.translate(cx,cy); ctx.rotate(t*0.6); ctx.strokeStyle='#8ed0ff'; ctx.lineWidth=3; ctx.globalAlpha=.9; for(let i=0;i<4;i++){ ctx.rotate(TAU/4); ctx.beginPath(); ctx.moveTo(r+2,0); ctx.quadraticCurveTo(r+18,8, r+32,0); ctx.quadraticCurveTo(r+18,-8, r+2,0); ctx.stroke(); } ctx.restore(); ctx.globalAlpha=1; }

  function draw(){ const w=state.w/devicePixelRatio, h=state.h/devicePixelRatio; ctx.clearRect(0,0,w,h); const cx=w/2,cy=h/2; ctx.save(); ctx.globalAlpha=.1; ctx.lineWidth=1; ctx.strokeStyle='#3c4b7a'; for(let rr=50; rr<Math.max(w,h); rr+=50){ ctx.beginPath(); ctx.arc(cx,cy,rr,0,TAU); ctx.stroke(); } ctx.restore(); drawBoss(cx,cy); for(const ring of boss.rings){ ctx.save(); ctx.translate(cx,cy); ctx.rotate(ring.angle); ctx.lineWidth=ring.w; ctx.strokeStyle='#8ed0ff'; ctx.beginPath(); ctx.arc(0,0,ring.r, ring.gap, TAU); ctx.stroke(); ctx.restore(); } const px=cx+Math.cos(player.angle)*player.radius, py=cy+Math.sin(player.angle)*player.radius; drawShip(px,py,player.angle+Math.PI); for(const b of bullets){ ctx.beginPath(); ctx.fillStyle=(b.owner==='p')?'#e6f7ff':'#ffa76b'; ctx.arc(b.x/devicePixelRatio,b.y/devicePixelRatio,b.r,0,TAU); ctx.fill(); } hud.innerHTML=`<div class='pill'><strong>Lvl</strong> ${state.level}</div><div class='pill'><strong>Boss</strong> ${Math.max(0,boss.hp)}/${boss.maxHp}</div><div class='pill'><strong>Score</strong> ${state.score}</div>`; }

  let last=performance.now(); function loop(now){ const dt=Math.min(0.033,(now-last)/1000); last=now; if(state.running) update(dt); draw(); requestAnimationFrame(loop);} requestAnimationFrame(loop);
  addEventListener('keydown', e=>{ if(e.key.toLowerCase()==='r'){ reset(); } });
  initLevel();
})();
</script>
</body>
</html>
