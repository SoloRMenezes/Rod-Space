<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Pac-Man 3D — Arcade FPS</title>
<style>
  html,body{height:100%;margin:0;background:#03060f;color:#bfe9ff;font-family:system-ui,-apple-system,Segoe UI,Inter,Roboto,sans-serif;overflow:hidden}
  #game{display:block;width:100vw;height:100vh}

  /* ===== Minimap + compact HUD (bottom-left) ===== */
  #hudMini{position:fixed;left:12px;bottom:200px;z-index:8;text-shadow:0 1px 0 rgba(0,0,0,.45)}
  #hudMini .row{display:flex;gap:.6rem;align-items:center}
  .pill{padding:2px 8px;border-radius:999px;border:1px solid rgba(191,233,255,.25);background:#0c1326}
  #map{position:fixed;left:12px;bottom:12px;width:160px;height:176px;background:rgba(10,20,40,.86);border:2px solid #2049ff;border-radius:10px;box-shadow:0 0 10px rgba(32,73,255,.35) inset;z-index:8;display:none}

  /* ✚ Crosshair */
  #crosshair{
    position:fixed;top:50%;left:50%;
    width:20px;height:20px;transform:translate(-50%,-50%);
    pointer-events:none;z-index:9;display:none;
  }
  #crosshair::before,#crosshair::after{
    content:"";position:absolute;background:#fff;opacity:.85;
  }
  #crosshair::before{width:2px;height:20px;left:9px;top:0}
  #crosshair::after{width:20px;height:2px;left:0;top:9px}

  /* Lives popup on death */
  #lifePopup{position:fixed;inset:0;display:none;place-items:center;z-index:12}
  #lifePopup .box{padding:12px 18px;border-radius:12px;background:rgba(8,12,24,.78);border:1px solid rgba(191,233,255,.2)}
  .fade{animation:fade .75s ease}
  @keyframes fade{from{opacity:0;transform:translateY(-6px)}to{opacity:1;transform:none}}

  /* ===== Start / Pause Screen ===== */
  #startScreen{
    position:fixed;inset:0;z-index:20;display:grid;place-items:center;
    background:radial-gradient(1200px 600px at 50% -20%, #0b1a6e 0%, #06113d 35%, #03060f 70%);
  }
  .menu{
    width:min(90vw,540px);
    background:rgba(6,12,28,.6);
    border:1px solid rgba(191,233,255,.15);
    border-radius:18px;
    padding:28px 26px;
    box-shadow:0 10px 40px rgba(0,0,0,.5), inset 0 0 40px rgba(32,73,255,.1);
    text-align:center;
  }
  .title{font-size:40px;font-weight:800;letter-spacing:.02em;margin:0 0 18px}
  .subtitle{opacity:.8;margin-top:2px;margin-bottom:18px}
  .btn{
    display:block;width:100%;padding:12px 14px;margin:10px 0;border-radius:12px;
    border:1px solid #2049ff;background:#0b1a6e;color:#e7f3ff;font-weight:700;
    box-shadow:0 0 12px rgba(32,73,255,.25) inset;cursor:pointer;transition:transform .08s ease, box-shadow .2s ease, background .2s ease;
  }
  .btn:hover{transform:translateY(-1px);box-shadow:0 0 24px rgba(32,73,255,.45) inset;background:#1233c7}
  .btn.secondary{background:#0c1326;border-color:#2c3e73}
  .credits{margin-top:12px;font-size:12px;opacity:.8}

  /* Panels for Keybinds / Credits (mini separate screens) */
  .panel{display:none;position:fixed;inset:0;z-index:30;place-items:center;background:rgba(0,0,0,.6)}
  .panel .box{width:min(90vw,420px);background:rgba(8,16,32,.95);border:1px solid rgba(191,233,255,.18);border-radius:16px;padding:20px;text-align:center}
  .panel h3{margin-top:0}
  .kbd{padding:2px 6px;border:1px solid #607dff;background:#0c1326;border-radius:6px}
  .range{width:80%}
</style>
</head>
<body>
  <canvas id="game"></canvas>

  <!-- Compact HUD above minimap -->
  <div id="hudMini">
    <div class="row">
      <span class="pill">Score: <strong id="score">0</strong></span>
      <span class="pill">Level: <strong id="level">1</strong></span>
    </div>
  </div>

  <!-- Minimap -->
  <canvas id="map" width="160" height="176" aria-label="Minimap"></canvas>

  <!-- Crosshair -->
  <div id="crosshair"></div>

  <!-- Lives popup -->
  <div id="lifePopup"><div class="box fade" id="lifeText">Lives: 3</div></div>

  <!-- Start / Pause Screen -->
  <div id="startScreen">
    <div class="menu">
      <h1 class="title">PAC-MAN 3D</h1>
      <div class="subtitle">Arcade maze in first-person</div>
      <button id="btnStart" class="btn">Start Game</button>
      <button id="btnKeys" class="btn secondary">Keybinds</button>
      <button id="btnCredits" class="btn secondary">Credits</button>
      <div class="credits">© Rod Space</div>
    </div>
  </div>

  <!-- Keybinds Panel -->
  <div id="panelKeys" class="panel">
    <div class="box">
      <h3>Keybinds</h3>
      <p><span class="kbd">WASD</span> move • Mouse look<br>
         <span class="kbd">Space</span> minimap • <span class="kbd">P</span> pause • <span class="kbd">R</span> reset<br>
         <span class="kbd">Shift</span> toggle cursor-lock • <span class="kbd">Esc</span> main menu</p>
      <label>Sensitivity: <span id="sensVal">1.00x</span></label><br>
      <input type="range" id="sensSlider" class="range" min="0.2" max="2" step="0.05" value="1"/>
      <br><br><button id="closeKeys" class="btn">Back</button>
    </div>
  </div>

  <!-- Credits Panel -->
  <div id="panelCredits" class="panel">
    <div class="box">
      <h3>Credits</h3>
      <p>Created by Rodrigo — inspired by the Pac-Man game and Dark Deception playstyle.</p>
      <button id="closeCredits" class="btn">Back</button>
    </div>
  </div>

<script type="module">
import * as THREE from 'https://unpkg.com/three@0.160.0/build/three.module.js';

/* ===================== MENU ===================== */
// (same as your version — omitted for brevity, unchanged setup ...)

/* ===================== MAIN LOOP ===================== */
let prev=performance.now();
function loop(now){
  const dt=Math.min(0.033,(now-prev)/1000); prev=now;
  pelletMat.emissiveIntensity = 1.2 + Math.sin(now*0.004)*0.28;

  if(state.playing && !state.paused){
    movePlayer(dt); // ✅ added this line so WASD always works
    ghosts.forEach(g=>{ ghostAI(g); moveGhost(g,dt); });
    eat(); checkDeaths();
    state.modeTime+=dt;
    if(state.fright>0){
      state.fright-=dt;
      if(state.fright<=0){ state.fright=0; ghosts.forEach(g=>{ if(!g.eyes) g.mesh.material.color.setHex(g.color); }); }
    }else if(state.mode==='scatter' && state.modeTime>7){ state.mode='chase'; state.modeTime=0; }
     else if(state.mode==='chase' && state.modeTime>20){ state.mode='scatter'; state.modeTime=0; }
  }
  if(mapVisible) drawMap();
  renderer.render(scene,camera);
  requestAnimationFrame(loop);
}
requestAnimationFrame(loop);
</script>
</body>
</html>
